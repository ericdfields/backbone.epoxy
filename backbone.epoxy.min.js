// Backbone.Epoxy 1.0.2
// (c) 2013 Greg MacWilliam
// Freely distributed under the MIT license
// http://epoxyjs.org
!function(a,b){var c="backbone",d="underscore";"undefined"!=typeof exports?module.exports=b(require(d),require(c)):"function"==typeof define&&define.amd?define([d,c],b):b(a._,a.Backbone)}(this,function(a,b){function c(a){return function(b,c,d){return a.prototype[c].apply(b,d)}}function d(b,c,e,f){for(var g in c)if(c.hasOwnProperty(g)){var h=c[g];if(b.hasComputed(g)){if(f.length&&!(a.indexOf(f,g)<0))throw"Recursive setter: "+f.join(" > ");h=b.c()[g].set(h),h&&t(h)&&(e=d(b,h,e,f.concat(g)))}else e[g]=h}return e}function e(b,c,d,e){d=d||{},d.get&&s(d.get)&&(d._get=d.get),d.set&&s(d.set)&&(d._set=d.set),delete d.get,delete d.set,a.extend(this,d),this.model=b,this.name=c,this.deps=this.deps||[],e||this.init()}function f(b){return s(b)?b():(t(b)&&(b=a.clone(b),a.each(b,function(a,c){b[c]=f(a)})),b)}function g(a){return s(a)?{set:a}:a}function h(b){return function(){var c=arguments,d=s(b)?b:b.get,e=b.set;return function(b){return r(b)?d.apply(this,a.map(c,f)):c[0]((e?e:d).call(this,b))}}}function i(b,c,d,e,f){return(b=a.result(b,e))?(v(b)?(f=f?f+"_":"",c["$"+e]=function(){return p.utils.view.viewMap&&p.utils.view.viewMap.push([b,"change"]),b},a.each(b.toJSON({computed:!0}),function(a,e){c[f+e]=function(a){return j(b,e,a,d)}})):w(b)&&(c["$"+e]=function(){return p.utils.view.viewMap&&p.utils.view.viewMap.push([b,"reset add remove sort update"]),b}),b):void 0}function j(a,b,c,d){if(p.utils.view.viewMap&&p.utils.view.viewMap.push([a,"change:"+b]),!r(c)){if(!t(c)||u(c)){var e=c;(c={})[b]=e}return d&&d.save?a.save(c,d):a.set(c,d)}return a.get(b)}function k(a,b){if(":el"===b)return a.$el;var c=a.$(b);return a.$el.is(b)&&(c=c.add(a.$el)),c}function l(b,c,d,e,f,g){try{var h=A[d]||(A[d]=new Function("$f","$c","with($f){with($c){return{"+d+"}}}")),i=h(g,e)}catch(j){throw'Error parsing bindings: "'+d+'"\n>> '+j}var k=a.map(a.union(i.events||[],["change"]),function(a){return a+".epoxy"}).join(" ");a.each(i,function(a,d){f.hasOwnProperty(d)&&b.b().push(new o(c,f[d],a,k,e,i))})}function m(a,b,c,d){if(b.callee.caller&&b.callee.caller.id===c)throw"Recursive access error: "+c;return a&&a.hasOwnProperty(c)?r(d)?f(a[c]):a[c](d):void 0}function n(a,b){var c=[];if(b&&a)for(var d=0,e=b.length;e>d;d++)c.push(b[d]in a?a[b[d]]():null);return c}function o(b,c,d,e,g,h){var i=this,j=b[0].tagName.toLowerCase(),k="input"==j||"select"==j||"textarea"==j||"true"==b.prop("contenteditable"),l=[],m=function(a){i.set(i.$el,f(d),a)};if(i.$el=b,i.evt=e,a.extend(i,c),d=i.init(i.$el,f(d),g,h)||d,p.utils.view.viewMap=l,m(),p.utils.view.viewMap=null,k&&c.get&&s(d)&&i.$el.on(e,function(a){d(i.get(i.$el,f(d),a))}),l.length)for(var n=0,o=l.length;o>n;n++)i.listenTo(l[n][0],l[n][1],m)}var p=b.Epoxy={},q=Array.prototype,r=a.isUndefined,s=a.isFunction,t=a.isObject,u=a.isArray,v=function(a){return a instanceof b.Model},w=function(a){return a instanceof b.Collection},x=function(){},y={mixin:function(a){a=a||{};for(var b in this.prototype)this.prototype.hasOwnProperty(b)&&"constructor"!==b&&(a[b]=this.prototype[b]);return a}};p.utils={model:{modelMap:[],modelSuper:c(b.Model),modelProps:["computeds"]},view:{viewMap:[],viewSuper:c(b.View),viewProps:["viewModel","bindings","bindingFilters","bindingHandlers","bindingSources","computeds"]}},p.Model=b.Model.extend({constructor:function(b,c){a.extend(this,a.pick(c||{},p.utils.model.modelProps)),p.utils.model.modelSuper(this,"constructor",arguments),this.initComputeds()},getCopy:function(b){return a.clone(this.get(b))},get:function(a){return p.utils.model.modelMap&&p.utils.model.modelMap.push(["change:"+a,this]),this.hasComputed(a)?this.c()[a].get():p.utils.model.modelSuper(this,"get",arguments)},set:function(a,b,c){var e=a;return e&&!t(e)?(e={},e[a]=b):c=b,c=c||{},c.unset||(e=d(this,e,{},[])),p.utils.model.modelSuper(this,"set",[e,c])},toJSON:function(b){var c=p.utils.model.modelSuper(this,"toJSON",arguments);return b&&b.computed&&a.each(this.c(),function(a,b){c[b]=a.value}),c},destroy:function(){return this.clearComputeds(),p.utils.model.modelSuper(this,"destroy",arguments)},c:function(){return this._c||(this._c={})},initComputeds:function(){this.clearComputeds(),a.each(a.result(this,"computeds")||{},function(a,b){a._init=1,this.addComputed(b,a)},this),a.invoke(this.c(),"init")},addComputed:function(a,b,c){this.removeComputed(a);var d=b,f=d._init;if(s(b)){var g=2;d={},d._get=b,s(c)&&(d._set=c,g++),d.deps=q.slice.call(arguments,g)}return this.c()[a]=new e(this,a,d,f),this},hasComputed:function(a){return this.c().hasOwnProperty(a)},removeComputed:function(a){return this.hasComputed(a)&&(this.c()[a].dispose(),delete this.c()[a]),this},clearComputeds:function(){for(var a in this.c())this.removeComputed(a);return this},modifyArray:function(a,b){var c=this.get(a);if(u(c)&&s(q[b])){var d=q.slice.call(arguments,2),e=q[b].apply(c,d);return this.trigger("change change:"+a),e}return null},modifyObject:function(a,b,c){var d=this.get(a),e=!1;return t(d)?(r(c)&&d.hasOwnProperty(b)?(delete d[b],e=!0):d[b]!==c&&(d[b]=c,e=!0),e&&this.trigger("change change:"+a),d):null}},y),a.extend(e.prototype,b.Events,{init:function(){var b={},c=p.utils.model.modelMap=[];this.get(!0),p.utils.model.modelMap=null,c.length&&(a.each(c,function(c){var d=c[0],e=c[1];b[d]?a.contains(b[d],e)||b[d].push(e):b[d]=[e]}),a.each(b,function(b,c){for(var d=0,e=b.length;e>d;d++)this.listenTo(b[d],c,a.bind(this.get,this,!0))},this))},val:function(a){return this.model.get(a)},get:function(b){if(b===!0&&this._get){var c=this._get.apply(this.model,a.map(this.deps,this.val,this));this.change(c)}return this.value},set:function(a){if(this._get){if(this._set)return this._set.apply(this.model,arguments);throw"Cannot set read-only computed attribute."}return this.change(a),null},change:function(b){a.isEqual(b,this.value)||(this.value=b,this.model.trigger("change:"+this.name+" change",this.model))},dispose:function(){this.stopListening(),this.off(),this.model=this.value=null}});var z={optionText:"label",optionValue:"value"},A={},B={attr:g(function(a,b){a.attr(b)}),checked:g({get:function(b,c){var d=!!b.prop("checked"),e=b.val();if(this.isRadio(b))return e;if(u(c)){c=c.slice();var f=a.indexOf(c,e);return d&&0>f?c.push(e):!d&&f>-1&&c.splice(f,1),c}return d},set:function(b,c){var d=!!c;this.isRadio(b)?d=c==b.val():u(c)&&(d=a.contains(c,b.val())),b.prop("checked",d)},isRadio:function(a){return"radio"===a.attr("type").toLowerCase()}}),classes:g(function(b,c){a.each(c,function(a,c){b.toggleClass(c,!!a)})}),collection:g({init:function(a,b){if(!w(b)||!s(b.view))throw'Binding "collection" requires a Collection with a "view" constructor.';this.v={}},set:function(b,c,d){var e,f=this.v,g=c.models,h=p.utils.view.viewMap;if(p.utils.view.viewMap=null,d=d||c,v(d))if(f.hasOwnProperty(d.cid))f[d.cid].remove(),delete f[d.cid];else{f[d.cid]=e=new c.view({model:d});var i=a.indexOf(g,d),j=b.children();i<j.length?j.eq(i).before(e.$el):b.append(e.$el)}else if(w(d)){var k=g.length===a.size(f)&&c.every(function(a){return f.hasOwnProperty(a.cid)});b.hide(),k?c.each(function(a){b.append(f[a.cid].$el)}):(this.clean(),c.each(function(a){f[a.cid]=e=new c.view({model:a}),b.append(e.$el)})),b.show()}p.utils.view.viewMap=h},clean:function(){for(var a in this.v)this.v.hasOwnProperty(a)&&(this.v[a].remove(),delete this.v[a])}}),css:g(function(a,b){a.css(b)}),disabled:g(function(a,b){a.prop("disabled",!!b)}),enabled:g(function(a,b){a.prop("disabled",!b)}),html:g(function(a,b){a.html(b)}),options:g({init:function(a,b,c,d){this.e=d.optionsEmpty,this.d=d.optionsDefault,this.v=d.value},set:function(b,c){var d=this,e=f(d.e),g=f(d.d),h=f(d.v),i=u(h)?h:[h],j=w(c)?c.models:c,k=j.length,l=!0,m="";k||g||!e?(g&&(j=[g].concat(j)),a.each(j,function(a){m+=d.opt(a,k,i)})):(m+=d.opt(e,k,i),l=!1),b.html(m).prop("disabled",!l);var n=b.val();d.v&&!a.isEqual(h,n)&&d.v(n)},opt:function(b,c,d){var e=b,f=b,g=z.optionText,h=z.optionValue;t(b)&&(e=v(b)?b.get(g):b[g],f=v(b)?b.get(h):b[h]);var i=!c||a.contains(d,f)?'" selected="selected">':'">';return'<option value="'+f+i+e+"</option>"},clean:function(){this.d=this.e=this.v=0}}),template:g({init:function(b,c,d){var e=b.find("script,template");return this.t=a.template(e.length?e.html():b.html()),u(c)?a.pick(d,c):void 0},set:function(a,b){b=v(b)?b.toJSON({computed:!0}):b,a.html(this.t(b))},clean:function(){this.t=null}}),text:g(function(a,b){a.text(b)}),toggle:g(function(a,b){a.toggle(!!b)}),value:g({get:function(a){return a.val()},set:function(a,b){try{a.val()!=b&&a.val(b)}catch(c){}}})},C={all:h(function(){for(var a=arguments,b=0,c=a.length;c>b;b++)if(!a[b])return!1;return!0}),any:h(function(){for(var a=arguments,b=0,c=a.length;c>b;b++)if(a[b])return!0;return!1}),length:h(function(a){return a.length||0}),none:h(function(){for(var a=arguments,b=0,c=a.length;c>b;b++)if(a[b])return!1;return!0}),not:h(function(a){return!a}),format:h(function(a){for(var b=arguments,c=1,d=b.length;d>c;c++)a=a.replace(new RegExp("\\$"+c,"g"),b[c]);return a}),select:h(function(a,b,c){return a?b:c}),csv:h({get:function(a){return a=String(a),a?a.split(","):[]},set:function(a){return u(a)?a.join(","):a}}),integer:h(function(a){return a?parseInt(a,10):0}),decimal:h(function(a){return a?parseFloat(a):0})};return p.binding={addHandler:function(a,b){B[a]=g(b)},addFilter:function(a,b){C[a]=h(b)},config:function(b){a.extend(z,b)},emptyCache:function(){A={}}},p.View=b.View.extend({constructor:function(b){a.extend(this,a.pick(b||{},p.utils.view.viewProps)),p.utils.view.viewSuper(this,"constructor",arguments),this.applyBindings()},b:function(){return this._b||(this._b=[])},bindings:"data-bind",setterOptions:null,applyBindings:function(){this.removeBindings();var b=this,c=a.clone(a.result(b,"bindingSources")),d=b.bindings,e=b.setterOptions,f=a.clone(B),j=a.clone(C),m=b._c={};a.each(a.result(b,"bindingHandlers")||{},function(a,b){f[b]=g(a)}),a.each(a.result(b,"bindingFilters")||{},function(a,b){j[b]=h(a)}),b.model=i(b,m,e,"model"),b.viewModel=i(b,m,e,"viewModel"),b.collection=i(b,m,e,"collection"),c&&(a.each(c,function(a,b){c[b]=i(c,m,e,b,b)}),b.bindingSources=c),a.each(a.result(b,"computeds")||{},function(a,c){var d=s(a)?a:a.get,e=a.set,f=a.deps;d.id=c,m[c]=function(a){return!r(a)&&e?e.call(b,a):d.apply(b,n(b._c,f))}}),t(d)?a.each(d,function(a,c){var d=k(b,c);d.length&&l(b,d,a,m,f,j)}):k(b,"["+d+"]").each(function(){var a=$(this);l(b,a,a.attr(d),m,f,j)})},getBinding:function(a){return m(this._c,arguments,a)},setBinding:function(a,b){return m(this._c,arguments,a,b)},removeBindings:function(){if(this._c=null,this._b)for(;this._b.length;)this._b.pop().dispose()},remove:function(){this.removeBindings(),p.utils.view.viewSuper(this,"remove",arguments)}},y),a.extend(o.prototype,b.Events,{init:x,get:x,set:x,clean:x,dispose:function(){this.clean(),this.stopListening(),this.$el.off(this.evt),this.$el=null}}),p});
//# sourceMappingURL=backbone.epoxy.min.map